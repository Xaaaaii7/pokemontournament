<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Torneig - Equip de Josep</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Estilos mejorados para la tabla */
        .pokemon-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            font-size: 0.95em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .pokemon-table thead tr {
            background-color: #e60012;
            color: white;
            text-align: center;
            font-weight: bold;
        }
        
        .pokemon-table th {
            padding: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9em;
        }
        
        .pokemon-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .pokemon-table tbody tr {
            background-color: white;
            transition: all 0.2s ease;
        }
        
        .pokemon-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .pokemon-table tbody tr:hover {
            background-color: #fff5f5;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .pokemon-table .pokemon-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #333;
        }
        
        .pokemon-table .pokemon-name img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #f0f0f0;
        }
        
        .pokemon-table .tipo-cell {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .pokemon-table .tipo-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: contain;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .pokemon-table .ratio-cell {
            font-weight: bold;
            color: #e60012;
        }
        
        .section-title {
            color: #e60012;
            border-bottom: 2px solid #e60012;
            padding-bottom: 8px;
            margin-top: 30px;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <!-- Resto de tu c√≥digo HTML (header, nav, etc.) -->

    <main class="equipo-entrenador">
        <header class="entrenador-header">
            <img src="https://img.pokemondb.net/sprites/trainers/normal/ace-trainer-m.png" alt="Josep">
            <div>
                <h1 class="section-title">Equip de Josep</h1>
                <div class="entrenador-stats">
                    <!-- Las stats se llenar√°n con JavaScript -->
                </div>
            </div>
        </header>

        <section>
            <h2 class="section-title">Tots els Pok√©mon</h2>
            <table class="pokemon-table" id="pokemon-table">
                <thead>
                    <tr>
                        <th data-sort="name">Nom</th>
                        <th data-sort="type">Tipus</th>
                        <th data-sort="battles" data-sort-init="desc">Combats</th>
                        <th data-sort="kills">Kills</th>
                        <th data-sort="deaths">Morts</th>
                        <th data-sort="ratio">Proporci√≥</th>
                        <th data-sort="deathsAdventure">Morts/Aventura</th>
                    </tr>
                </thead>
                <tbody id="pokemon-container">
                    <!-- Los Pok√©mon se cargar√°n aqu√≠ desde JSON -->
                </tbody>
            </table>
        </section>
        
        <section>
            <h2 class="section-title">Pok√©mon inscrits</h2>
            <table class="pokemon-table" id="inscrits-table">
                <thead>
                    <tr>
                        <th data-sort="name">Nom</th>
                        <th data-sort="type">Tipus</th>
                        <th data-sort="battles">Combats</th>
                        <th data-sort="kills">Kills</th>
                        <th data-sort="deaths">Morts</th>
                        <th data-sort="ratio">Proporci√≥</th>
                        <th data-sort="deathsAdventure">Morts/Aventura</th>
                    </tr>
                </thead>
                <tbody id="inscrits-container">
                    <!-- Los Pok√©mon inscritos se cargar√°n aqu√≠ desde JSON -->
                </tbody>
            </table>
        </section>
    </main>

<script type="module">
  import { cargarDatos, calcularKC } from './data-loader.js';

  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const data = await cargarDatos();
      const entrenador = data.entrenadores.josep;
      let allPokemonData = [];
      let inscritosData = [];

      /* Header ------------------------------------------------------------- */
      const header = document.querySelector('.entrenador-header');
      if (header) {
        header.querySelector('img').src = entrenador.imagen;
        header.querySelector('h1').textContent = `Equip de ${entrenador.nombre}`;
        
        const proporcion = entrenador.battles > 0 
          ? (entrenador.kills / entrenador.battles).toFixed(2)
          : "0.00";
          
        header.querySelector('.entrenador-stats').innerHTML = `
          <span>üó°Ô∏è Abatuts: ${entrenador.kills}</span>
          <span>‚ò†Ô∏è Morts: ${entrenador.deaths}</span>
          <span>‚öîÔ∏è Combats: ${entrenador.battles}</span>
          <span>‚ö° Proporci√≥: ${proporcion}</span>`;
      }

      /* Preparar datos de Pok√©mon ----------------------------------------- */
      allPokemonData = entrenador.equipo.map(p => {
        const ratio = typeof calcularKC(p) === 'number' ? calcularKC(p) : 0;
        return {
          ...p,
          ratio: ratio,
          deathsAdventure: p.deathsAdventure || 0,
          type: p.ataques.join(',')
        };
      });
      
      inscritosData = allPokemonData.filter(p => p.inscrito);

      /* Renderizar tablas iniciales --------------------------------------- */
      renderTable('pokemon-container', allPokemonData);
      renderTable('inscrits-container', inscritosData);

      /* Configurar ordenaci√≥n -------------------------------------------- */
      setupSorting('pokemon-table', 'pokemon-container', allPokemonData);
      setupSorting('inscrits-table', 'inscrits-container', inscritosData);

      /* Funci√≥n para renderizar tabla ------------------------------------ */
      function renderTable(containerId, pokemonList) {
        const container = document.getElementById(containerId);
        if (container) {
          container.innerHTML = pokemonList.map(renderRow).join('');
        }
      }

      /* Funci√≥n para renderizar fila (con nuevo dise√±o) ------------------ */
      function renderRow(p) {
        const ratio = typeof p.ratio === 'number' ? p.ratio.toFixed(2) : "0.00";
        
        return `
          <tr>
            <td>
              <div class="pokemon-name">
                <img src="${p.imagen}" alt="${p.nombre}">
                <a href="https://www.wikidex.net/wiki/${p.nombre}">${p.nombre}</a>
              </div>
            </td>
            <td class="tipo-cell">
              ${p.ataques
                .map(t => `<img class="tipo-icon" src="img/${t}.png" alt="${t}">`)
                .join('')}
            </td>
            <td>${p.battles}</td>
            <td>${p.kills}</td>
            <td>${p.deaths}</td>
            <td class="ratio-cell">${ratio}</td>
            <td>${p.deathsAdventure}</td>
          </tr>`;
      }

      /* Funci√≥n para configurar ordenaci√≥n ------------------------------- */
      function setupSorting(tableId, containerId, pokemonData) {
        const table = document.getElementById(tableId);
        if (!table) return;
        
        const headers = table.querySelectorAll('th[data-sort]');
        let currentData = [...pokemonData];
        
        headers.forEach(header => {
          if (header.hasAttribute('data-sort-init')) {
            const sortOrder = header.getAttribute('data-sort-init');
            sortTable(header.getAttribute('data-sort'), sortOrder);
            header.classList.add(`sort-${sortOrder}`);
          }
          
          header.addEventListener('click', () => {
            const sortKey = header.getAttribute('data-sort');
            const isAsc = header.classList.contains('sort-asc');
            const newOrder = isAsc ? 'desc' : 'asc';
            
            headers.forEach(h => {
              h.classList.remove('sort-asc', 'sort-desc');
            });
            
            header.classList.add(`sort-${newOrder}`);
            sortTable(sortKey, newOrder);
          });
        });
        
        function sortTable(sortKey, order) {
          currentData.sort((a, b) => {
            let valueA, valueB;
            
            if (sortKey === 'type') {
              valueA = a.ataques.join('');
              valueB = b.ataques.join('');
            } else {
              valueA = sortKey === 'ratio' ? Number(a[sortKey]) : a[sortKey];
              valueB = sortKey === 'ratio' ? Number(b[sortKey]) : b[sortKey];
            }
            
            if (valueA == null) valueA = sortKey === 'name' ? '' : 0;
            if (valueB == null) valueB = sortKey === 'name' ? '' : 0;
            
            if (valueA < valueB) return order === 'asc' ? -1 : 1;
            if (valueA > valueB) return order === 'asc' ? 1 : -1;
            return 0;
          });
          
          renderTable(containerId, currentData);
        }
      }
    } catch (error) {
      console.error('Error cargando los datos:', error);
    }
  });
</script>

</body>
</html>
