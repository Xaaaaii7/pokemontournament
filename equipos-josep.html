<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Torneig - Equip de Josep</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Estilos adicionales para la tabla de ranking */
        .pokemon-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .pokemon-table thead tr {
            background-color: #e60012;
            color: white;
            text-align: left;
        }
        
        .pokemon-table th,
        .pokemon-table td {
            padding: 12px 15px;
        }
        
        .pokemon-table th {
            cursor: pointer;
            position: relative;
        }
        
        .pokemon-table th:hover {
            background-color: #c5000f;
        }
        
        .pokemon-table th.sort-asc::after {
            content: " ‚Üë";
        }
        
        .pokemon-table th.sort-desc::after {
            content: " ‚Üì";
        }
        
        .pokemon-table tbody tr {
            border-bottom: 1px solid #dddddd;
        }
        
        .pokemon-table tbody tr:nth-of-type(even) {
            background-color: #f3f3f3;
        }
        
        .pokemon-table tbody tr:last-of-type {
            border-bottom: 2px solid #e60012;
        }
        
        .pokemon-table tbody tr:hover {
            background-color: #f5f5f5;
        }
        
        .pokemon-table .tipo-cell {
            display: flex;
            gap: 5px;
        }
        
        .pokemon-table .tipo-icon {
            width: 30px;
            height: 30px;
        }
        
        .pokemon-table .pokemon-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pokemon-table .pokemon-name img {
            width: 40px;
            height: 40px;
        }
    </style>
</head>
<body>
    <header style="text-align:center; padding:1rem; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
      <img src="images.jpeg" alt="Pok√©mon Escarlata y P√∫rpura" style="max-width:100%; height:auto; border-radius:12px;" />
    </header>
<nav>
  <ul>
    <li><a href="index.html">Not√≠cies</a></li>
    <li><a href="reglas.html">Regles</a></li>
    <li><a href="#">Classificacions ‚ñº</a>
    <ul>
        <li><a href="leaderboard.html">Classificaci√≥ Pokemon</a></li>
        <li><a href="leaderboard-entrenadores.html">Classificaci√≥ Entrenadors</a></li>
      </ul>
    </li>
    <li>
      <a href="equipos.html">Equips ‚ñº</a>
      <ul>
        <li><a href="equipos-jordi.html">Jordi</a></li>
        <li><a href="equipos-josep.html">Josep</a></li>
        <li><a href="equipos-eudald.html">Eudald</a></li>
      </ul>
    </li>
    <li><a href="combates.html">Combats</a></li>
  </ul>
</nav>

    <main class="equipo-entrenador">
        <header class="entrenador-header">
            <img src="https://img.pokemondb.net/sprites/trainers/normal/ace-trainer-m.png" alt="Josep">
            <div>
                <h1>Equip de Josep</h1>
                <div class="entrenador-stats">
                    <!-- Las stats se llenar√°n con JavaScript -->
                </div>
            </div>
        </header>

        <section>
          <h2>Tots els Pok√©mon</h2>
          <table class="pokemon-table" id="pokemon-table">
            <thead>
              <tr>
                <th data-sort="name">Nom</th>
                <th data-sort="type">Tipus</th>
                <th data-sort="battles" data-sort-init="desc">Combats</th>
                <th data-sort="kills">Kills</th>
                <th data-sort="deaths">Morts</th>
                <th data-sort="ratio">Proporci√≥</th>
                <th data-sort="deathsAdventure">MortsAventura</th>
              </tr>
            </thead>
            <tbody id="pokemon-container">
              <!-- Los Pok√©mon se insertar√°n aqu√≠ -->
            </tbody>
          </table>
        </section>
        
        <section>
          <h2>Pok√©mon inscrits</h2>
          <table class="pokemon-table" id="inscrits-table">
            <thead>
              <tr>
                <th data-sort="name">Nom</th>
                <th data-sort="type">Tipus</th>
                <th data-sort="battles" data-sort-init="desc">Combats</th>
                <th data-sort="kills">Kills</th>
                <th data-sort="deaths">Morts</th>
                <th data-sort="ratio">Proporci√≥</th>
                <th data-sort="deathsAdventure">MortsAventura</th>
              </tr>
            </thead>
            <tbody id="inscrits-container">
              <!-- Los Pok√©mon inscritos se insertar√°n aqu√≠ -->
            </tbody>
          </table>
        </section>
    </main>

<script type="module">
  import { cargarDatos, calcularKC } from './data-loader.js';

  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const data       = await cargarDatos();
      const entrenador = data.entrenadores.josep;
      let allPokemonData = [];
      let inscritosData = [];

      /* Header ------------------------------------------------------------- */
      const header = document.querySelector('.entrenador-header');
      if (header) {
        header.querySelector('img').src        = entrenador.imagen;
        header.querySelector('h1').textContent = `Equip de ${entrenador.nombre}`;
        header.querySelector('.entrenador-stats').innerHTML = `
          <span>üó°Ô∏è Abatuts: ${entrenador.kills}</span>
          <span>‚ò†Ô∏è Morts: ${entrenador.deaths}</span>
          <span>‚öîÔ∏è Combats: ${entrenador.battles}</span>
          <span>‚ö° Proporci√≥: ${(entrenador.kills / entrenador.battles).toFixed(2)}</span>`;
      }

      /* Preparar datos de Pok√©mon ----------------------------------------- */
      allPokemonData = entrenador.equipo.map(p => ({
        ...p,
        ratio: calcularKC(p),
        deathsAdventure: p.deathsAdventure || 0,
        type: p.ataques.join(',')
      }));
      
      inscritosData = allPokemonData.filter(p => p.inscrito);

      /* Renderizar tablas iniciales --------------------------------------- */
      renderTable('pokemon-container', allPokemonData);
      renderTable('inscrits-container', inscritosData);

      /* Configurar ordenaci√≥n -------------------------------------------- */
      setupSorting('pokemon-table', 'pokemon-container', allPokemonData);
      setupSorting('inscrits-table', 'inscrits-container', inscritosData);

      /* Funci√≥n para renderizar tabla ------------------------------------ */
      function renderTable(containerId, pokemonList) {
        const container = document.getElementById(containerId);
        if (container) {
          container.innerHTML = pokemonList.map(renderRow).join('');
        }
      }

      /* Funci√≥n para renderizar fila ------------------------------------- */
      function renderRow(p) {
        return `
          <tr>
            <td class="pokemon-name">
              <img src="${p.imagen}" alt="${p.nombre}">
              <a href="https://www.wikidex.net/wiki/${p.nombre}">${p.nombre}</a>
            </td>
            <td class="tipo-cell">
              ${p.ataques
                .map(t => `<img class="tipo-icon" src="img/${t}.png" alt="${t}">`)
                .join('')}
            </td>
            <td>${p.battles}</td>
            <td>${p.kills}</td>
            <td>${p.deaths}</td>
            <td>${p.ratio.toFixed(2)}</td>
            <td>${p.deathsAdventure}</td>
          </tr>`;
      }

      /* Funci√≥n para configurar ordenaci√≥n ------------------------------- */
      function setupSorting(tableId, containerId, pokemonData) {
        const table = document.getElementById(tableId);
        const headers = table.querySelectorAll('th[data-sort]');
        let currentData = [...pokemonData];
        
        headers.forEach(header => {
          // Orden inicial si est√° especificado
          if (header.hasAttribute('data-sort-init')) {
            const sortOrder = header.getAttribute('data-sort-init');
            sortTable(header.getAttribute('data-sort'), sortOrder);
            header.classList.add(`sort-${sortOrder}`);
          }
          
          header.addEventListener('click', () => {
            const sortKey = header.getAttribute('data-sort');
            const isAsc = header.classList.contains('sort-asc');
            const newOrder = isAsc ? 'desc' : 'asc';
            
            // Resetear clases de ordenaci√≥n en todos los headers
            headers.forEach(h => {
              h.classList.remove('sort-asc', 'sort-desc');
            });
            
            // Aplicar clase al header actual
            header.classList.add(`sort-${newOrder}`);
            
            // Ordenar y renderizar
            sortTable(sortKey, newOrder);
          });
        });
        
        function sortTable(sortKey, order) {
          currentData.sort((a, b) => {
            let valueA, valueB;
            
            // Para ordenar por tipos (que es un array)
            if (sortKey === 'type') {
              valueA = a.ataques.join('');
              valueB = b.ataques.join('');
            } else {
              valueA = a[sortKey];
              valueB = b[sortKey];
            }
            
            if (valueA < valueB) {
              return order === 'asc' ? -1 : 1;
            }
            if (valueA > valueB) {
              return order === 'asc' ? 1 : -1;
            }
            return 0;
          });
          
          renderTable(containerId, currentData);
        }
      }
    } catch (error) {
      console.error('Error cargando los datos:', error);
    }
  });
</script>

</body>
</html>
