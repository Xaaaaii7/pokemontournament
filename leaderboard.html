<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pokemon Torneig - Clasificaci√≥ Pok√©mon</title>
<link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header style="text-align:center; padding:1rem; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
  <img src="images.jpeg" alt="Pok√©mon Escarlata y P√∫rpura" style="max-width:100%; height:auto; border-radius:12px;" />
</header>
<nav>
  <ul>
    <li><a href="index.html">Not√≠cies</a></li>
    <li><a href="reglas.html">Regles</a></li>
    <li><a href="#">Classificacions ‚ñº</a>
    <ul>
        <li><a href="leaderboard.html">Classificaci√≥ Pokemon</a></li>
        <li><a href="leaderboard-entrenadores.html">Classificaci√≥ Entrenadors</a></li>
      </ul>
    </li>
    <li>
      <a href="equipos.html">Equips ‚ñº</a>
      <ul>
        <li><a href="equipos-jordi.html">Jordi</a></li>
        <li><a href="equipos-josep.html">Josep</a></li>
        <li><a href="equipos-eudald.html">Eudald</a></li>
      </ul>
    </li>
  </ul>
</nav>

<div class="leaderboard" id="leaderboard">
  <div class="loading">Cargant classificaci√≥ Pok√©mon...</div>
</div>

<script type="module">
  import { cargarDatos, calcularKC } from './data-loader.js';

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const data = await cargarDatos();
      
      // Obtener todos los Pok√©mon de todos los entrenadores
      const pokemons = [];
      Object.values(data.entrenadores).forEach(entrenador => {
        entrenador.equipo.forEach(pokemon => {
          pokemons.push({
            name: pokemon.nombre,
            img: pokemon.imagen,
            kills: pokemon.kills,
            deaths: pokemon.deaths,
            battles: pokemon.battles,
            entrenador: entrenador.nombre
          });
        });
      });
      for (let i = pokemons.length - 1; i >= 0; i--) {
  if (pokemons[i].battles === 0) {
    pokemons.splice(i, 1); // Elimina el Pok√©mon si no tiene batallas
  }
}
      // Calcular kills por combate
      pokemons.forEach(p => {
        p.killsPerBattle = calcularKC(p);
      });

      pokemons.sort((a, b) => {
  // Primero comparar por kills (descendente)
  if (b.kills !== a.kills) {
    return b.kills - a.kills;
  }
  
  // Si kills son iguales, comparar por ratio (descendente)
  if (b.killsPerBattle !== a.killsPerBattle) {
    return b.killsPerBattle - a.killsPerBattle;
  }
  
  // Si ratio son iguales, comparar por deaths (ascendente)
  if (a.deaths !== b.deaths) {
    return b.death - a.death;
  }
  
  // Si deaths son iguales, comparar por batallas (ascendente)
  return a.battles - b.battles;
});
      
      const [first, second, third, ...others] = pokemons;
      const lb = document.getElementById('leaderboard');

      // Generar HTML (mismo formato que antes)
      lb.innerHTML = `
        <div class="title">üèÜ Classificaci√≥ Pok√©mon</div>
        
        <!-- Primer puesto -->
        <div class="top-card champion">
          <img src="${first.img}" alt="${first.name}">
          <div class="stats">
            <h2>${first.name}</h2>
            <p class="entrenador">Entrenador: ${first.entrenador}</p>
            <div class="numbers">
              <span>‚öîÔ∏è ${first.battles}</span>
              <span>üó°Ô∏è ${first.kills}</span>
              <span>‚ò†Ô∏è ${first.deaths}</span>
              <span>‚ö° ${first.killsPerBattle}</span>
            </div>
          </div>
        </div>
        
        <!-- Segundo y tercer puesto -->
        <div class="podium">
          ${[second, third].map(p => `
            <div class="podium-card">
              <img src="${p.img}" alt="${p.name}">
              <div class="stats">
                <h3>${p.name}</h3>
                <p class="entrenador">Entrenador: ${p.entrenador}</p>
                <div class="numbers">
                  <span>‚öîÔ∏è ${p.battles}</span>
                  <span>üó°Ô∏è ${p.kills}</span>
                  <span>‚ò†Ô∏è ${p.deaths}</span>
                  <span>‚ö° ${p.killsPerBattle}</span>
                </div>
              </div>
            </div>`).join('')}
        </div>
        
        <!-- Dem√°s participantes (lista compacta) -->
        <ul class="compact-list">
          ${others.map((p, index) => `
            <li>
              <span class="pos">${index + 4}¬∫</span>
              <img src="${p.img}" alt="${p.name}" title="${p.name} (${p.entrenador})">
              <span class="icons">
                <span>üó°Ô∏è${p.kills}</span>
                <span>‚ò†Ô∏è${p.deaths}</span>
                <span>‚öîÔ∏è${p.battles}</span>
                <span>‚ö°${p.killsPerBattle}</span>
              </span>
              <span class="entrenador-mini">${p.entrenador}</span>
            </li>`).join('')}
        </ul>`;
    } catch (error) {
      console.error('Error cargando los datos:', error);
      document.getElementById('leaderboard').innerHTML = `
        <div class="error">
          <p>‚ö†Ô∏è No se pudo cargar la clasificaci√≥n</p>
          <p>${error.message}</p>
        </div>`;
    }
  });
</script>
</body>
</html>
