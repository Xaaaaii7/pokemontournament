<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pokemon Torneig - ClassificaciÃ³ Entrenadors</title>
<link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header style="text-align:center; padding:1rem; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
  <img src="images.jpeg" alt="PokÃ©mon Escarlata y PÃºrpura" style="max-width:100%; height:auto; border-radius:12px;" />
</header>
<nav>
  <ul>
    <li><a href="index.html">NotÃ­cies</a></li>
    <li><a href="reglas.html">Regles</a></li>
    <li><a href="#">Classificacions â–¼</a>
    <ul>
        <li><a href="leaderboard.html">ClassificaciÃ³ Pokemon</a></li>
        <li><a href="leaderboard-entrenadores.html">ClassificaciÃ³ Entrenadors</a></li>
      </ul>
    </li>
    <li>
      <a href="equipos.html">Equips â–¼</a>
      <ul>
        <li><a href="equipos-jordi.html">Jordi</a></li>
        <li><a href="equipos-josep.html">Josep</a></li>
        <li><a href="equipos-eudald.html">Eudald</a></li>
      </ul>
    </li>
    <li><a href="combates.html">Combats</a></li>
  </ul>
</nav>

<div class="leaderboard" id="leaderboard">
  <div class="loading">Cargant clasificaciÃ³...</div>
</div>

<script type="module">
  import { cargarDatos } from './data-loader.js';

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const data = await cargarDatos();
      const entrenadores = Object.values(data.entrenadores);
      
      // Calcular estadÃ­sticas para cada entrenador
      entrenadores.forEach(entrenador => {
        // Sumar kills y deaths de todos sus PokÃ©mon
        entrenador.totalKills = entrenador.equipo.reduce((sum, pokemon) => sum + (pokemon.kills || 0), 0);
        entrenador.totalDeaths = entrenador.equipo.reduce((sum, pokemon) => sum + (pokemon.deaths || 0), 0);
        
        // Calcular puntos (3 por victoria, 1 por empate)
        entrenador.puntos = (entrenador.wins * 3) + (entrenador.draw * 1);
      });

      // Ordenar con sistema de desempate
      entrenadores.sort((a, b) => {
        // Primero por puntos (descendente)
        if (b.puntos !== a.puntos) return b.puntos - a.puntos;
        
        // Si hay empate en puntos, ordenar por kills (descendente)
        else if (b.totalKills !== a.totalKills) return b.totalKills - a.totalKills;
        
        // Si persiste el empate, ordenar por menos muertes (ascendente)
        else{
        return a.totalDeaths - b.totalDeaths;
        }
      });
      
      const [first, second, third, ...others] = entrenadores;
      const lb = document.getElementById('leaderboard');

      // Resto del cÃ³digo permanece igual...
      lb.innerHTML = `
        <div class="title">ğŸ† ClassificaciÃ³ de Entrenadors</div>
        
        <!-- Primer puesto -->
        <div class="top-card champion">
          <img src="${first.imagen}" alt="${first.nombre}">
          <div class="stats">
            <h2>${first.nombre}</h2>
            <div class="numbers">
              <span title="Puntos">ğŸ† ${first.puntos}</span>
              <span title="Victorias">âœ… ${first.wins}</span>
              <span title="Derrotas">âŒ ${first.lose}</span>
              <span title="Empates">âš– ${first.draw}</span>
              <span title="Kills totales">ğŸ—¡ï¸ ${first.totalKills}</span>
              <span title="Muertes totales">â˜ ï¸ ${first.totalDeaths}</span>
            </div>
          </div>
        </div>
        
        <!-- Segundo y tercer puesto -->
        <div class="podium">
          ${[second, third].map(p => `
            <div class="podium-card">
              <img src="${p.imagen}" alt="${p.nombre}">
              <div class="stats">
                <h3>${p.nombre}</h3>
                <div class="numbers">
                  <span>ğŸ† ${p.puntos}</span>
                  <span>âœ… ${p.wins}</span>
                  <span>âŒ ${p.lose}</span>
                  <span>âš– ${p.draw}</span>
                  <span>ğŸ—¡ï¸ ${p.totalKills}</span>
                  <span>â˜ ï¸ ${p.totalDeaths}</span>
                </div>
              </div>
            </div>`).join('')}
        </div>
        
        <!-- DemÃ¡s participantes (lista compacta) -->
        <ul class="compact-list">
          ${others.map((p, index) => `
            <li>
              <span class="pos">${index + 4}Âº</span>
              <img src="${p.imagen}" alt="${p.nombre}" title="${p.nombre}">
              <span class="icons">
                <span title="Puntos">ğŸ†${p.puntos}</span>
                <span title="Victorias">âœ…${p.wins}</span>
                <span title="Derrotas">âŒ${p.lose}</span>
                <span title="Empates">âš–${p.draw}</span>
                <span title="Kills totales">ğŸ—¡ï¸${p.totalKills}</span>
                <span title="Muertes totales">â˜ ï¸${p.totalDeaths}</span>
              </span>
            </li>`).join('')}
        </ul>`;
    } catch (error) {
      console.error('Error:', error);
      document.getElementById('leaderboard').innerHTML = `
        <div class="error">
          <p>âš ï¸ No se pudo cargar la clasificaciÃ³n</p>
          <p>${error.message}</p>
        </div>`;
    }
  });
</script>
</body>
</html>
